
function prettySrcoll(element, options) {
	var defaultOptions = {
		barWidth: 8,
		barColor: 'rgba(0, 0, 0, 0.4)',
		barOffsetRight: 2
	};
	var config = Object.prototype.toString.call(options) === '[object Object]' ?
							Object.assign(defaultOptions, options) : defaultOptions;
	var ele = document.querySelector(element); //target element
	var height = parseInt(getStyle(ele).height); //target's height
	var width = parseInt(getStyle(ele).width); //target's width
	var scrollHeight = ele.scrollHeight; //target's true height
	var x = ele.getBoundingClientRect().left; //target's x coordinate
	var y = ele.getBoundingClientRect().top; //target's y coordinate
	var barHeight = height*height/scrollHeight;
	var wrapperStyle = 'position: absolute;top: '+y+'px;left: '+x+'px;width: '
							+width+'px;height: '+height+'px;';
	var barStyle = 'position: absolute;width: '+config.barWidth
							+'px;height: '+barHeight+'px;top: 0;left: '
							+(width-config.barOffsetRight-config.barWidth)
							+'px;background-color: '+config.barColor+';border-radius: '
							+config.barWidth+'px;transition: top 0.4s;';

	function getStyle(selector) {
		return selector.currentStyle ? selector.currentStyle : document.defaultView.getComputedStyle(selector, null);
	}

	function initScrollBar() {
		//var barWrapper = ele.cloneNode(false);
		var barWrapper = document.createElement('div'); // create wrapper
		var bar = document.createElement('div'); // create bar
		barWrapper.style = wrapperStyle;
		bar.style = barStyle;
		barWrapper.appendChild(bar);
		document.body.appendChild(barWrapper);

		initEventScroll(bar, barWrapper);
	}

	function initEventScroll(bar, wrapper) {
		function ScrollHandler(e) {
			var ev = e || event;
			var isDown = ev.wheelDelta < 0 ? true : false;
			if(isDown) {
				/*setInterval(function() {
					ele.scrollTop = ele.scrollTop + 1;
				});*/
				moveLinear(20);
				bar.style.top = (parseInt(bar.style.top)+10)+'px';
			} else {
				moveLinear(-20);
				bar.style.top = (parseInt(bar.style.top)-10)+'px';
			}
		}
		wrapper.addEventListener('wheel', ScrollHandler);
	}

	function fixTop() {

	}

	function moveLinear(length) {
		for(var i = 1;i <= Math.abs(length);i++) {
			setTimeout(function() {
				ele.scrollTop = length > 0 ? ele.scrollTop + 1 : ele.scrollTop - 1;
			}, 5*i);
		}
	}

	initScrollBar(ele);

}

module.exports = prettySrcoll;